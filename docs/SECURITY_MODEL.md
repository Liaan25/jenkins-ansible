# –ú–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–ø—Ä–∏–Ω—Ü–∏–ø—ã-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
4. [–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π](#—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ-–ø–æ–ª–Ω–æ–º–æ—á–∏–π)
5. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–µ–∫—Ä–µ—Ç–∞–º–∏)
6. [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–∏-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
7. [–°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#—Å–µ—Ç–µ–≤–∞—è-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
8. [–ê—É–¥–∏—Ç –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–∞—É–¥–∏—Ç-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
9. [–†–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã](#—Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ-–Ω–∞-–∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã)
10. [–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º](#—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º)

---

## –í–≤–µ–¥–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—É—é –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –±–∞–Ω–∫–∞ –∏ –ª—É—á—à–∏–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –¶–µ–ª–∏ –º–æ–¥–µ–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–µ–∫—Ä–µ—Ç—ã, –ø–∞—Ä–æ–ª–∏, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã)
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏
- –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

---

## –ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (Least Privilege)

–ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–≤–æ–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –£–ó
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ user systemd units –≤–º–µ—Å—Ç–æ system units
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä sudo –ø—Ä–∞–≤
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –º–µ–∂–¥—É —Ç–∏–ø–∞–º–∏ –£–ó

### 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π (Separation of Duties)

–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç —É—á–∞—Å—Ç–∏—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- 4 —Ç–∏–ø–∞ –£–ó —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –î–µ–ø–ª–æ–π (monitoring_ci) –æ—Ç–¥–µ–ª–µ–Ω –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è (monitoring_admin)
- –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (monitoring_svc) –æ—Ç–¥–µ–ª–µ–Ω –æ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 3. –ì–ª—É–±–æ–∫–∞—è –∑–∞—â–∏—Ç–∞ (Defense in Depth)

–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö —Å–∏—Å—Ç–µ–º—ã.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è (firewall)
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (mTLS)
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç—Ä–∞–Ω–∑–∏—Ç–µ
- –ó–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ tmpfs
- –ê—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Secure by Default)

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏–∑ –∫–æ—Ä–æ–±–∫–∏.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- HTTPS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ó–∞–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã (–∫—Ä–æ–º–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö)
- –°—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —Ñ–∞–π–ª—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

### 5. –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏

–£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ—Ä—Ç–∞–º
- NoLogin –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –£–ó
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tmpfs –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (–Ω–µ –æ—Å—Ç–∞–≤–ª—è—é—Ç —Å–ª–µ–¥–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –°—Ö–µ–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –í–ù–ï–®–ù–ò–ô –£–†–û–í–ï–ù–¨                              ‚îÇ
‚îÇ  Jenkins (CI/CD)                                                ‚îÇ
‚îÇ  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π AD                       ‚îÇ
‚îÇ  - RBAC –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º                                 ‚îÇ
‚îÇ  - Credentials —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ SSH (–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á)
                     ‚îÇ Vault AppRole (role_id + secret_id)
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –°–ï–¢–ï–í–û–ô –£–†–û–í–ï–ù–¨                               ‚îÇ
‚îÇ  Firewall (iptables)                                            ‚îÇ
‚îÇ  - Prometheus: —Ç–æ–ª—å–∫–æ localhost + IP —Å–µ—Ä–≤–µ—Ä–∞                   ‚îÇ
‚îÇ  - Grafana: –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ HTTPS                          ‚îÇ
‚îÇ  - Harvest: –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ HTTPS                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ mTLS + HTTPS
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  –£–†–û–í–ï–ù–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–ô                             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  ‚îÇ  Prometheus  ‚îÇ    ‚îÇ   Grafana    ‚îÇ    ‚îÇ   Harvest   ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ              ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ             ‚îÇ      ‚îÇ
‚îÇ  ‚îÇ  mTLS Server ‚îÇ    ‚îÇ  mTLS Client ‚îÇ    ‚îÇ  mTLS       ‚îÇ      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
‚îÇ         ‚îÇ                   ‚îÇ                    ‚îÇ              ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ                             ‚îÇ                                   ‚îÇ
‚îÇ                    –ß—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤                              ‚îÇ
‚îÇ                             ‚ñº                                   ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îÇ
‚îÇ         ‚îÇ  /dev/shm/monitoring_secrets/      ‚îÇ                  ‚îÇ
‚îÇ         ‚îÇ  (tmpfs –≤ RAM, 700, monitoring_svc)‚îÇ                  ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ AppRole Auth
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 –£–†–û–í–ï–ù–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø –°–ï–ö–†–ï–¢–ê–ú–ò                    ‚îÇ
‚îÇ  Vault Agent                                                    ‚îÇ
‚îÇ  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ AppRole                                ‚îÇ
‚îÇ  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞                            ‚îÇ
‚îÇ  - –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ /dev/shm                              ‚îÇ
‚îÇ  - –®–∞–±–ª–æ–Ω—ã –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –ø–∞—Ä–æ–ª–µ–π                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ HTTPS + JWT
                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –í–ù–ï–®–ù–ï–ï –•–†–ê–ù–ò–õ–ò–©–ï                             ‚îÇ
‚îÇ  Vault (SecMan)                                                 ‚îÇ
‚îÇ  - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤                          ‚îÇ
‚îÇ  - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤                         ‚îÇ
‚îÇ  - Audit log –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π                                     ‚îÇ
‚îÇ  - –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```
1. Jenkins ‚Üí Vault
   –ü—Ä–æ—Ç–æ–∫–æ–ª: HTTPS
   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: AppRole (role_id + secret_id)
   –î–∞–Ω–Ω—ã–µ: –ó–∞–ø—Ä–æ—Å —Å–µ–∫—Ä–µ—Ç–æ–≤
   –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ: TLS 1.2+

2. Jenkins ‚Üí Target Server
   –ü—Ä–æ—Ç–æ–∫–æ–ª: SSH
   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: RSA 4096-bit key
   –î–∞–Ω–Ω—ã–µ: –í—Ä–µ–º–µ–Ω–Ω—ã–π JSON —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏
   –†–∞–∑–º–µ—â–µ–Ω–∏–µ: /dev/shm (tmpfs, –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞)

3. Vault Agent ‚Üí Vault
   –ü—Ä–æ—Ç–æ–∫–æ–ª: HTTPS
   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: AppRole + JWT token
   –î–∞–Ω–Ω—ã–µ: –®–∞–±–ª–æ–Ω—ã —Å–µ–∫—Ä–µ—Ç–æ–≤
   –ß–∞—Å—Ç–æ—Ç–∞: Auto-renewal –∫–∞–∂–¥—ã–µ 24—á

4. Vault Agent ‚Üí /dev/shm
   –†–∞–∑–º–µ—â–µ–Ω–∏–µ: /dev/shm/monitoring_secrets/
   –ü—Ä–∞–≤–∞: 700 (—Ç–æ–ª—å–∫–æ monitoring_svc)
   –§–æ—Ä–º–∞—Ç: PEM –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, plain text –¥–ª—è –ø–∞—Ä–æ–ª–µ–π
   –°—Ä–æ–∫ –∂–∏–∑–Ω–∏: –î–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

5. Services ‚Üí /dev/shm
   –ß—Ç–µ–Ω–∏–µ: –¢–æ–ª—å–∫–æ monitoring_svc
   –ß–∞—Å—Ç–æ—Ç–∞: –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ + –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
   –ü—Ä–æ–≤–µ—Ä–∫–∞: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

6. Prometheus ‚Üê Harvest (mTLS)
   –ü—Ä–æ—Ç–æ–∫–æ–ª: HTTPS
   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: Mutual TLS (client + server cert)
   –í–∞–ª–∏–¥–∞—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä–∫–∞ CN –∏ SAN –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö
   –®–∏—Ñ—Ä-—Å—å—é—Ç—ã: –¢–æ–ª—å–∫–æ TLS_ECDHE_* —Å AES_128_GCM

7. Grafana ‚Üê Prometheus (mTLS)
   –ü—Ä–æ—Ç–æ–∫–æ–ª: HTTPS
   –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: Mutual TLS
   –î–∞–Ω–Ω—ã–µ: –ó–∞–ø—Ä–æ—Å—ã –º–µ—Ç—Ä–∏–∫
   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: –û—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

---

## –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π

### –ú–∞—Ç—Ä–∏—Ü–∞ –ø–æ–ª–Ω–æ–º–æ—á–∏–π

| –î–µ–π—Å—Ç–≤–∏–µ / –£–ó | monitoring_svc | monitoring_admin | monitoring_ci | monitoring_ro |
|---------------|----------------|------------------|---------------|---------------|
| **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤** | ‚úì (–≤–ª–∞–¥–µ–ª–µ—Ü) | ‚úì (—á–µ—Ä–µ–∑ sudo) | ‚úì (—á–µ—Ä–µ–∑ sudo) | ‚úó |
| **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤** | ‚úì | ‚úì (—á–µ—Ä–µ–∑ sudo) | ‚úì (—á–µ—Ä–µ–∑ sudo) | ‚úó |
| **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤** | ‚úì | ‚úì (—á–µ—Ä–µ–∑ sudo) | ‚úì (—á–µ—Ä–µ–∑ sudo) | ‚úó |
| **–ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞** | ‚úì | ‚úì | ‚úì | ‚úì (—á–µ—Ä–µ–∑ sudo) |
| **–ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤** | ‚úì | ‚úì | ‚úì | ‚úì (—á–µ—Ä–µ–∑ sudo) |
| **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤** | ‚úó | ‚úó | ‚úì | ‚úó |
| **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤** | ‚úó | ‚úó | ‚úì | ‚úó |
| **–ß—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤** | ‚úì (—Ç–æ–ª—å–∫–æ /dev/shm) | ‚úó | ‚úó | ‚úó |
| **–î–µ–ø–ª–æ–π** | ‚úó | ‚úó | ‚úì | ‚úó |
| **–°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤** | ‚úó | ‚úì | ‚úì | ‚úó |
| **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—Ö–æ–¥** | ‚úó (NoLogin) | ‚úì | ‚úì | ‚úì |

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

```
/opt/monitoring/
‚îú‚îÄ‚îÄ bin/                           # –ë–∏–Ω–∞—Ä–Ω–∏–∫–∏
‚îÇ   –í–ª–∞–¥–µ–ª–µ—Ü: monitoring_ci
‚îÇ   –ì—Ä—É–ø–ø–∞: monitoring
‚îÇ   –ü—Ä–∞–≤–∞: 750 (rwxr-x---)
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å: monitoring_ci
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å: monitoring_ci, monitoring_svc, monitoring_admin
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å: monitoring_ci, monitoring_svc, monitoring_admin
‚îÇ
‚îú‚îÄ‚îÄ config/                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   –í–ª–∞–¥–µ–ª–µ—Ü: monitoring_ci
‚îÇ   –ì—Ä—É–ø–ø–∞: monitoring
‚îÇ   –ü—Ä–∞–≤–∞: 750 (rwxr-x---)
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å: monitoring_ci
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å: –í—Å–µ –£–ó monitoring
‚îÇ
‚îú‚îÄ‚îÄ data/                          # –î–∞–Ω–Ω—ã–µ Prometheus
‚îÇ   –í–ª–∞–¥–µ–ª–µ—Ü: monitoring_svc
‚îÇ   –ì—Ä—É–ø–ø–∞: monitoring
‚îÇ   –ü—Ä–∞–≤–∞: 770 (rwxrwx---)
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å: monitoring_svc
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å: monitoring_svc, monitoring_admin (—á–µ—Ä–µ–∑ –≥—Ä—É–ø–ø—É)
‚îÇ
‚îú‚îÄ‚îÄ logs/                          # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
‚îÇ   –í–ª–∞–¥–µ–ª–µ—Ü: monitoring_svc
‚îÇ   –ì—Ä—É–ø–ø–∞: monitoring_admin
‚îÇ   –ü—Ä–∞–≤–∞: 770 (rwxrwx---)
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å: monitoring_svc
‚îÇ   –ö—Ç–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å: monitoring_svc, monitoring_admin, monitoring_ro
‚îÇ
‚îî‚îÄ‚îÄ scripts/                       # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
    –í–ª–∞–¥–µ–ª–µ—Ü: monitoring_ci
    –ì—Ä—É–ø–ø–∞: monitoring
    –ü—Ä–∞–≤–∞: 755 (rwxr-xr-x)
    –ö—Ç–æ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å: –í—Å–µ –£–ó

/dev/shm/monitoring_secrets/       # –°–µ–∫—Ä–µ—Ç—ã –≤ tmpfs (RAM)
    –í–ª–∞–¥–µ–ª–µ—Ü: monitoring_svc
    –ì—Ä—É–ø–ø–∞: monitoring
    –ü—Ä–∞–≤–∞: 700 (rwx------)
    –ö—Ç–æ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å: –¢–û–õ–¨–ö–û monitoring_svc
    –ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å: –¢–û–õ–¨–ö–û monitoring_svc
    –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞: –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–º–æ—á–∏–π

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Jenkins

```
1. Jenkins –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –≤ Vault (AppRole)
2. Jenkins –ø–æ–ª—É—á–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ Vault
3. Jenkins –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH (–∫–ª—é—á monitoring_ci)
4. Jenkins —Ä–∞–∑–º–µ—â–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –≤ /dev/shm (–ø—Ä–∞–≤–∞ 700, –≤–ª–∞–¥–µ–ª–µ—Ü monitoring_svc)
5. Jenkins –æ—Ç –∏–º–µ–Ω–∏ monitoring_ci:
   - –ö–æ–ø–∏—Ä—É–µ—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –≤ /opt/monitoring/bin/ (–≤–ª–∞–¥–µ–ª–µ—Ü monitoring_ci)
   - –ö–æ–ø–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥–∏ –≤ /opt/monitoring/config/ (–≤–ª–∞–¥–µ–ª–µ—Ü monitoring_ci)
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç systemd units —á–µ—Ä–µ–∑ sudo -u monitoring_svc
6. –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –æ—Ç –∏–º–µ–Ω–∏ monitoring_svc
7. –°–µ—Ä–≤–∏—Å—ã —á–∏—Ç–∞—é—Ç —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ /dev/shm (–¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —É monitoring_svc)
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –†—É—á–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

```
1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—Ö–æ–¥–∏—Ç –ø–æ–¥ monitoring_admin
2. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å: sudo systemctl --user status prometheus
3. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –ª–æ–≥–∏: sudo journalctl --user -u prometheus
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç: sudo systemctl --user restart prometheus
5. –ù–ï –ú–û–ñ–ï–¢ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ /opt/monitoring/config/)
6. –ù–ï –ú–û–ñ–ï–¢ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã (–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ /dev/shm/monitoring_secrets/)
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```
1. –ê—É–¥–∏—Ç–æ—Ä –≤—Ö–æ–¥–∏—Ç –ø–æ–¥ monitoring_ro
2. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: sudo systemctl --user status *
3. –ß–∏—Ç–∞–µ—Ç –ª–æ–≥–∏: sudo journalctl --user
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: cat /opt/monitoring/config/*.yml
5. –ù–ï –ú–û–ñ–ï–¢ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–∏—Å–∞–º–∏ (–Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ start/stop/restart)
6. –ù–ï –ú–û–ñ–ï–¢ –∏–∑–º–µ–Ω—è—Ç—å —Ñ–∞–π–ª—ã (–Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å)
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ–∫—Ä–µ—Ç–æ–≤

```
1. –ì–ï–ù–ï–†–ê–¶–ò–Ø/–°–û–ó–î–ê–ù–ò–ï
   ‚Üì
   Vault (SecMan)
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
   
2. –ò–ó–í–õ–ï–ß–ï–ù–ò–ï
   ‚Üì
   Vault Agent
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ AppRole
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
   
3. –†–ê–ó–ú–ï–©–ï–ù–ò–ï
   ‚Üì
   /dev/shm/monitoring_secrets/
   - tmpfs (—Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤ RAM)
   - –ü—Ä–∞–≤–∞ 700
   - –í–ª–∞–¥–µ–ª–µ—Ü monitoring_svc
   - –ù–ï –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫
   
4. –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
   ‚Üì
   –°–µ—Ä–≤–∏—Å—ã (Prometheus, Grafana, Harvest)
   - –ß—Ç–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
   
5. –†–û–¢–ê–¶–ò–Ø
   ‚Üì
   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —á–µ—Ä–µ–∑ Vault Agent
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ /dev/shm
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (HUP signal)
   
6. –£–î–ê–õ–ï–ù–ò–ï
   ‚Üì
   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
   - –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ Vault Agent
   - –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ (tmpfs –æ—á–∏—â–∞–µ—Ç—Å—è)
   - –°–∫—Ä–∏–ø—Ç—ã –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
```

### –¢–∏–ø—ã —Å–µ–∫—Ä–µ—Ç–æ–≤

#### 1. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã TLS

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏ mTLS –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**–•—Ä–∞–Ω–µ–Ω–∏–µ**:
```
/dev/shm/monitoring_secrets/
‚îú‚îÄ‚îÄ server.crt            # –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (640)
‚îú‚îÄ‚îÄ server.key            # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á —Å–µ—Ä–≤–µ—Ä–∞ (600)
‚îú‚îÄ‚îÄ client.crt            # –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (640)
‚îú‚îÄ‚îÄ client.key            # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞ (600)
‚îú‚îÄ‚îÄ grafana-client.crt    # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è Grafana (640)
‚îú‚îÄ‚îÄ grafana-client.key    # –ö–ª—é—á –¥–ª—è Grafana (600)
‚îî‚îÄ‚îÄ ca_chain.crt          # CA —Ü–µ–ø–æ—á–∫–∞ (644)
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: 90 –¥–Ω–µ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∑–∞ 7 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è)

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
openssl x509 -in /dev/shm/monitoring_secrets/server.crt -noout -dates

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–ª—é—á–∞ –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
openssl x509 -noout -modulus -in /dev/shm/monitoring_secrets/server.crt | openssl md5
openssl rsa -noout -modulus -in /dev/shm/monitoring_secrets/server.key | openssl md5
# MD5 –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å
```

#### 2. –ü–∞—Ä–æ–ª–∏ –∏ —Ç–æ–∫–µ–Ω—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ API

**–•—Ä–∞–Ω–µ–Ω–∏–µ**: –ù–ï –≤ —Ñ–∞–π–ª–∞—Ö, –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è systemd

**–ü—Ä–∏–º–µ—Ä**:
```ini
# –í systemd unit —Ñ–∞–π–ª–µ
[Service]
EnvironmentFile=/dev/shm/monitoring_secrets/grafana.env
# –ì–¥–µ grafana.env —Å–æ–¥–µ—Ä–∂–∏—Ç:
# GRAFANA_ADMIN_PASSWORD=<–ø–∞—Ä–æ–ª—å>
# –ü—Ä–∞–≤–∞: 600, –≤–ª–∞–¥–µ–ª–µ—Ü monitoring_svc
```

**–†–æ—Ç–∞—Ü–∏—è**: –ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ –≤—Ä—É—á–Ω—É—é + –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏

#### 3. AppRole credentials

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è Vault Agent –≤ Vault

**–•—Ä–∞–Ω–µ–Ω–∏–µ**:
```
/opt/vault/conf/
‚îú‚îÄ‚îÄ role_id.txt           # Role ID (640)
‚îî‚îÄ‚îÄ secret_id.txt         # Secret ID (640)
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è**: Role ID - –±–µ—Å—Å—Ä–æ—á–Ω—ã–π, Secret ID - 90 –¥–Ω–µ–π

**–†–æ—Ç–∞—Ü–∏—è**: Secret ID –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Vault Agent

### –ó–∞—â–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –æ—Ç –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏

#### –£—Ä–æ–≤–µ–Ω—å 1: –°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è

- –°–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ HTTPS
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ VPN –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Vault
- Firewall –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø

#### –£—Ä–æ–≤–µ–Ω—å 2: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

- AppRole –¥–ª—è Vault Agent
- mTLS –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –≤ Vault (—Ç–æ–ª—å–∫–æ read –¥–ª—è –Ω—É–∂–Ω—ã—Ö –ø—É—Ç–µ–π)

#### –£—Ä–æ–≤–µ–Ω—å 3: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

- –°–µ–∫—Ä–µ—Ç—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã –≤ Vault at rest
- TLS 1.2+ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏
- –ù–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ (—Ç–æ–ª—å–∫–æ tmpfs)

#### –£—Ä–æ–≤–µ–Ω—å 4: –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏

- –°–µ–∫—Ä–µ—Ç—ã –≤ tmpfs (–æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è
- –ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–æ–≤

#### –£—Ä–æ–≤–µ–Ω—å 5: –ê—É–¥–∏—Ç

- –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ Vault –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- Audit log –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º —Å–µ–∫—Ä–µ—Ç–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### –ü–ª–∞–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—é —Å–µ–∫—Ä–µ—Ç–æ–≤

#### –ï—Å–ª–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**:
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
   sudo -u monitoring_svc systemctl --user stop prometheus grafana harvest
   
   # –£–¥–∞–ª–∏—Ç—å —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
   sudo -u monitoring_svc rm -f /dev/shm/monitoring_secrets/*.crt
   sudo -u monitoring_svc rm -f /dev/shm/monitoring_secrets/*.key
   ```

2. **–û—Ç–æ–∑–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ Vault**:
   - –°–æ–∑–¥–∞—Ç—å revocation –∑–∞–ø—Ä–æ—Å –≤ PKI
   - –û–±–Ω–æ–≤–∏—Ç—å CRL (Certificate Revocation List)

3. **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã**:
   ```bash
   # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Vault Agent –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
   sudo -u monitoring_svc systemctl --user restart vault-agent-monitoring
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã —Å –Ω–æ–≤—ã–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏**:
   ```bash
   sudo -u monitoring_svc systemctl --user start prometheus grafana harvest
   ```

5. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–∞—Å—à—Ç–∞–± –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏

#### –ï—Å–ª–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω –ø–∞—Ä–æ–ª—å:

1. **–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ Vault**
2. **–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö** —á–µ—Ä–µ–∑ Vault Agent
3. **–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏** –≤ Grafana/Prometheus
4. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### –£—Ä–æ–≤–Ω–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (SSH)

**–ú–µ—Ç–æ–¥**: Public key authentication

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```bash
# –î–ª—è monitoring_ci (Jenkins)
~/.ssh/authorized_keys —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á Jenkins
–¢–∏–ø –∫–ª—é—á–∞: RSA 4096-bit –∏–ª–∏ Ed25519
Passphrase: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∫–ª—é—á–µ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ
```

**–ó–∞—â–∏—Ç–∞**:
- –û—Ç–∫–ª—é—á–µ–Ω password authentication –≤ sshd_config
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP (AllowUsers monitoring_ci@<Jenkins_IP>)
- Fail2ban –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

#### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Vault (AppRole)

**–ú–µ—Ç–æ–¥**: AppRole authentication

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- `role_id`: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–æ–ª–∏ (–∞–Ω–∞–ª–æ–≥ username)
- `secret_id`: –°–µ–∫—Ä–µ—Ç —Ä–æ–ª–∏ (–∞–Ω–∞–ª–æ–≥ password)

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
```hcl
secret_id_ttl = "90d"          # –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è secret_id
token_ttl = "24h"               # –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞
token_max_ttl = "720h"          # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫ —Ç–æ–∫–µ–Ω–∞
token_policies = ["monitoring-read"]  # –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
```

**–ü—Ä–æ—Ü–µ—Å—Å**:
```
1. Vault Agent —á–∏—Ç–∞–µ—Ç role_id –∏ secret_id –∏–∑ —Ñ–∞–π–ª–æ–≤
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /auth/approle/login —Å role_id + secret_id
3. –ü–æ–ª—É—á–∞–µ—Ç token —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç token –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ–∫—Ä–µ—Ç–∞–º
5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç token –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
```

#### 3. Mutual TLS (mTLS) –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

**–£—á–∞—Å—Ç–Ω–∏–∫–∏**: Prometheus ‚Üê Harvest, Grafana ‚Üê Prometheus

**–ü—Ä–æ—Ü–µ—Å—Å**:
```
1. CLIENT Hello (—Å client certificate)
2. SERVER Hello (—Å server certificate)
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω:
   - –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
   - –ü–æ–¥–ø–∏—Å—å CA
   - CN (Common Name) = –æ–∂–∏–¥–∞–µ–º—ã–π hostname
   - SAN (Subject Alternative Names)
4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
5. –û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus** (require client cert):
```yaml
tls_server_config:
  client_auth_type: "RequireAndVerifyClientCert"
  client_ca_file: "/dev/shm/monitoring_secrets/ca_chain.crt"
  client_allowed_sans:
    - "<SERVER_DOMAIN>"
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Grafana** (–æ—Ç–ø—Ä–∞–≤–∫–∞ client cert):
```ini
[dataproxy]
tls_client_cert = /dev/shm/monitoring_secrets/grafana-client.crt
tls_client_key = /dev/shm/monitoring_secrets/grafana-client.key
tls_ca_cert = /dev/shm/monitoring_secrets/ca_chain.crt
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### 1. RBAC –≤ Grafana

**–†–æ–ª–∏**:
- **Admin**: –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø (–¥–ª—è monitoring_admin —á–µ—Ä–µ–∑ web UI)
- **Editor**: –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤
- **Viewer**: –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä (–¥–ª—è monitoring_ro)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞**:
```ini
[auth.basic]
enabled = true

[users]
default_role = Viewer

[security]
admin_user = admin  # –ò–∑ Vault
admin_password = <–∏–∑ /dev/shm/monitoring_secrets/grafana.env>
```

#### 2. –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –≤ Vault

**–ü–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è Vault Agent**:
```hcl
# Path: monitoring-read

# –ß—Ç–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
path "pki/issue/monitoring" {
  capabilities = ["create", "update"]
}

# –ß—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
path "secret/data/monitoring/*" {
  capabilities = ["read"]
}

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
path "auth/token/renew-self" {
  capabilities = ["update"]
}
```

#### 3. Sudo –ø—Ä–∞–≤–∞ (–ø–æ–¥—Ä–æ–±–Ω–æ –≤ SUDOERS_GUIDE.md)

–Ø–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ wildcards –¥–ª—è –∫–∞–∂–¥–æ–π –£–ó.

---

## –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Firewall –ø—Ä–∞–≤–∏–ª–∞ (iptables)

#### Prometheus (–ø–æ—Ä—Ç 9090)

**–ü–æ–ª–∏—Ç–∏–∫–∞**: –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å localhost –∏ IP —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å localhost
iptables -I INPUT 1 -p tcp -s 127.0.0.1 --dport 9090 -j ACCEPT

# –†–∞–∑—Ä–µ—à–∏—Ç—å IP —Å–µ—Ä–≤–µ—Ä–∞
iptables -I INPUT 1 -p tcp -s <SERVER_IP> --dport 9090 -j ACCEPT

# –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–µ
iptables -I INPUT 3 -p tcp --dport 9090 -j REJECT

# IPv6
ip6tables -I INPUT 1 -p tcp -s ::1 --dport 9090 -j ACCEPT
ip6tables -I INPUT 2 -p tcp --dport 9090 -j REJECT
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**: Prometheus —Å–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ

#### Grafana (–ø–æ—Ä—Ç 3000)

**–ü–æ–ª–∏—Ç–∏–∫–∞**: –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –ø–æ HTTPS

```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ–º
iptables -A INPUT -p tcp --dport 3000 -j ACCEPT
```

**–ó–∞—â–∏—Ç–∞**:
- HTTPS –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ Grafana
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º AD/LDAP

#### Harvest (–ø–æ—Ä—Ç—ã 12990, 12991)

**–ü–æ–ª–∏—Ç–∏–∫–∞**: 
- 12990 (HTTPS) - –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
- 12991 (HTTP, Unix –º–µ—Ç—Ä–∏–∫–∏) - —Ç–æ–ª—å–∫–æ localhost

```bash
# 12990 - –ø—É–±–ª–∏—á–Ω—ã–π
iptables -A INPUT -p tcp --dport 12990 -j ACCEPT

# 12991 - —Ç–æ–ª—å–∫–æ localhost
iptables -A INPUT -p tcp -s 127.0.0.1 --dport 12991 -j ACCEPT
iptables -A INPUT -p tcp --dport 12991 -j REJECT
```

### –°–µ—Ç–µ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```
Internet
    ‚îÇ
    ‚îÇ HTTPS (3000)
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Firewall      ‚îÇ
‚îÇ  (iptables)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ
    ‚îÇ 3000    ‚îÇ 9090 (–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–∑–≤–Ω–µ)
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Grafana ‚îÇ ‚îÇ Prometheus   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Harvest  ‚îÇ
‚îÇ :3000   ‚îÇ ‚îÇ :9090        ‚îÇ mTLS ‚îÇ :12990   ‚îÇ
‚îÇ         ‚îÇ ‚îÇ              ‚îÇ      ‚îÇ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ mTLS
     ‚îÇ client cert
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Prometheus   ‚îÇ
‚îÇ :9090        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–õ–µ–≥–µ–Ω–¥–∞:
‚îÄ‚îÄ‚îÄ –æ–±—ã—á–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
‚óÑ‚îÄ‚îÄ mTLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
üîí  HTTPS
üîê  mTLS (mutual TLS)
```

### –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∞—Ç–∞–∫

#### 1. DDoS –∑–∞—â–∏—Ç–∞

**–ú–µ—Ö–∞–Ω–∏–∑–º—ã**:
- Rate limiting –≤ Grafana
- Connection limits –≤ systemd units
- iptables rate limiting

**–ü—Ä–∏–º–µ—Ä** (systemd):
```ini
[Service]
LimitNOFILE=10000              # –õ–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
LimitNPROC=100                  # –õ–∏–º–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```

#### 2. Man-in-the-Middle (MITM) –∑–∞—â–∏—Ç–∞

**–ú–µ—Ö–∞–Ω–∏–∑–º—ã**:
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π TLS –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–Ω–µ—Ç insecure_skip_verify)
- Certificate pinning –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

#### 3. Port scanning –∑–∞—â–∏—Ç–∞

**–ú–µ—Ö–∞–Ω–∏–∑–º—ã**:
- –ó–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ—Ä—Ç–æ–≤
- Fail2ban –¥–ª—è SSH
- –°–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–π –≤ HTTP headers

---

## –ê—É–¥–∏—Ç –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

#### 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ (systemd/journald)

```bash
# –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
journalctl --user -u prometheus

# –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –£–ó monitoring_svc
journalctl _UID=<UID_monitoring_svc>

# –û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
journalctl -p err
```

#### 2. Sudo –ª–æ–≥–∏

```bash
# –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ sudo
journalctl -t sudo

# –û—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
journalctl -t sudo | grep monitoring_ci

# –§–æ—Ä–º–∞—Ç: –∫—Ç–æ, –∫–æ–≥–¥–∞, –∫–∞–∫—É—é –∫–æ–º–∞–Ω–¥—É, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ–≥–æ
```

#### 3. SSH –ª–æ–≥–∏

```bash
# –í—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è SSH
journalctl -u sshd

# –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
journalctl -u sshd | grep "Failed password"

# –£—Å–ø–µ—à–Ω—ã–µ –≤—Ö–æ–¥—ã
journalctl -u sshd | grep "Accepted publickey"
```

#### 4. Vault Audit Log

**–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è**:
- –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ API Vault
- –£—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Å–µ–∫—Ä–µ—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

**–§–æ—Ä–º–∞—Ç**: JSON

**–ê–Ω–∞–ª–∏–∑**:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Vault Agent
journalctl --user -u vault-agent-monitoring

# –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏
journalctl --user -u vault-agent-monitoring | grep "auth"
```

#### 5. –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

**Prometheus**:
```
/opt/monitoring/logs/prometheus/prometheus.log
- –ó–∞–ø—Ä–æ—Å—ã –º–µ—Ç—Ä–∏–∫
- –û—à–∏–±–∫–∏ scraping
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
```

**Grafana**:
```
/opt/monitoring/logs/grafana/grafana.log
- –í—Ö–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤
- API –∑–∞–ø—Ä–æ—Å—ã
```

**Harvest**:
```
/opt/monitoring/logs/harvest/harvest.log
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ NetApp
- –û—à–∏–±–∫–∏ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### –ú–µ—Ç—Ä–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Prometheus

```promql
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤ SSH
node_auth_failures_total

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞ (–¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π)
node_filesystem_avail_bytes{mountpoint="/opt/monitoring"}

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
node_netstat_Tcp_CurrEstab

# –ü—Ä–æ—Ü–µ—Å—Å—ã –æ—Ç monitoring_svc
node_processes{user="monitoring_svc"}

# –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
probe_ssl_earliest_cert_expiry{job="prometheus"}
```

#### –ê–ª–µ—Ä—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```yaml
groups:
  - name: security
    rules:
      # –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å—Ç–µ–∫–∞–µ—Ç –º–µ–Ω–µ–µ —á–µ–º —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
      - alert: CertificateExpiringSoon
        expr: probe_ssl_earliest_cert_expiry - time() < 7 * 24 * 3600
        annotations:
          summary: "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç {{ $labels.instance }} –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ {{ $value | humanizeDuration }}"

      # –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
      - alert: TooManySSHFailures
        expr: rate(node_auth_failures_total[5m]) > 5
        annotations:
          summary: "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {{ $value }} –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ SSH –≤ –º–∏–Ω—É—Ç—É"

      # –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
      - alert: ServiceDown
        expr: up{job=~"prometheus|grafana|harvest"} == 0
        for: 5m
        annotations:
          summary: "–°–µ—Ä–≤–∏—Å {{ $labels.job }} –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
```

### –†–µ—Ç–µ–Ω—Ü–∏—è –ª–æ–≥–æ–≤

| –¢–∏–ø –ª–æ–≥–∞ | –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è | –†–æ—Ç–∞—Ü–∏—è |
|----------|-----------------|---------|
| –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ (journald) | 30 –¥–Ω–µ–π | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è |
| Sudo –ª–æ–≥–∏ | 90 –¥–Ω–µ–π | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è |
| SSH –ª–æ–≥–∏ | 90 –¥–Ω–µ–π | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è |
| –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π | 14 –¥–Ω–µ–π | –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è |
| –ú–µ—Ç—Ä–∏–∫–∏ Prometheus | 15 –¥–Ω–µ–π | –ü–æ —Ä–∞–∑–º–µ—Ä—É |
| Vault Audit | 365 –¥–Ω–µ–π | –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ Vault |

---

## –†–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

#### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è)

- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è root/sudo –ø—Ä–∞–≤
- –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ Vault
- –£—Ç–µ—á–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ (–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ç–∏)
2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–ª—É–∂–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
4. –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å 2 (–í—ã—Å–æ–∫–∞—è)

- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- –ê–Ω–æ–º–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –ª–æ–≥–∞—Ö

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –°–º–µ–Ω–∞ –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
2. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
3. –£—Å–∏–ª–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –¥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É–≥—Ä–æ–∑—ã

#### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å 3 (–°—Ä–µ–¥–Ω—è—è)

- –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
2. –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. –£–ª—É—á—à–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

### –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è

#### 1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –£–ó

```bash
# 1. –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –£–ó
sudo passwd -l <compromised_user>

# 2. –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏
sudo pkill -9 -u <compromised_user>

# 3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–∞–Ω–¥
sudo cat /home/<compromised_user>/.bash_history

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep <compromised_user>

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã
sudo lsof -u <compromised_user>

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
sudo netstat -anp | grep <UID>

# 7. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏
sudo journalctl _UID=<UID> --since "24 hours ago"

# 8. –ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É–≥—Ä–æ–∑—ã:
# - –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
# - –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏
# - –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```

#### 2. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ SSH
sudo journalctl -u sshd | grep "Failed\|Invalid"

# 2. –î–æ–±–∞–≤–∏—Ç—å IP –≤ blacklist (fail2ban)
sudo fail2ban-client set sshd banip <IP>

# 3. –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã—Ç—å SSH –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö IP
sudo iptables -A INPUT -p tcp --dport 22 -s <SAFE_IP> -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -j DROP

# 4. –£–≤–µ–¥–æ–º–∏—Ç—å —Å–ª—É–∂–±—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
# 5. –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑ –º–∞—Å—à—Ç–∞–±–∞ –∞—Ç–∞–∫–∏
```

#### 3. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Ç–µ—á–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤

```bash
# 1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Vault
vault token revoke -self

# 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
vault write -f pki/revoke serial_number=<serial>

# 3. –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo -u monitoring_svc systemctl --user restart vault-agent-monitoring

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å –Ω–æ–≤—ã–º–∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
sudo -u monitoring_svc systemctl --user restart prometheus grafana harvest

# 5. –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤
# 6. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ —É—Ç–µ—á–∫–∏
# 7. –£—Å–∏–ª–∏—Ç—å –∑–∞—â–∏—Ç—É —Å–µ–∫—Ä–µ—Ç–æ–≤
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **–°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: SecurityIncident@example.com
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä Vault**: vault-admin@example.com
- **On-Call Engineer**: +7-XXX-XXX-XXXX
- **ServiceNow**: –ö–∞—Ç–µ–≥–æ—Ä–∏—è "Security Incident"

---

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –ø–æ–ª–∏—Ç–∏–∫–∞–º

‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ü–û –∏–∑ –ø–æ—Ä—Ç–∞–ª–∞ –î–ò**
- –í—Å–µ RPM –ø–∞–∫–µ—Ç—ã –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –î–ò

‚úÖ **–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ RLM**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ RLM
- –°–æ–∑–¥–∞–Ω–∏–µ –§–° —á–µ—Ä–µ–∑ RLM
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏ —á–µ—Ä–µ–∑ RLM/IDM

‚úÖ **–ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø–æ–ª–Ω–æ–º–æ—á–∏–π**
- 4 —Ç–∏–ø–∞ –£–ó —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä sudo –∫–æ–º–∞–Ω–¥
- User systemd units

‚úÖ **–ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏**
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç monitoring_svc (–Ω–µ root)
- NoLogin –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–π –£–ó

‚úÖ **–û—Ç–¥–µ–ª—å–Ω–∞—è –§–°**
- /opt/monitoring —Å –ø—Ä–∞–≤–∞–º–∏ monitoring_ci
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ bin/config/data/logs

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤**
- tmpfs (/dev/shm), –Ω–µ –Ω–∞ –¥–∏—Å–∫–µ
- –ü—Ä–∞–≤–∞ 700, —Ç–æ–ª—å–∫–æ –¥–ª—è monitoring_svc
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π**
- –°–£–ó, –ü–£–ó, –¢–£–ó, ReadOnly —Å —Ä–∞–∑–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥–∞–º

‚úÖ **–Ø–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ sudo**
- –ë–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ wildcards
- –ü–æ–ª–Ω—ã–µ –ø—É—Ç–∏ –∫–æ–º–∞–Ω–¥
- –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

‚úÖ **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥**
- User units –≤–º–µ—Å—Ç–æ system units
- –ù–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### PCI DSS

- Requirement 2: –ò–∑–º–µ–Ω–µ–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–∞—Ä–æ–ª–∏, –æ—Ç–∫–ª—é—á–µ–Ω password auth –¥–ª—è SSH
- Requirement 3: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (TLS, —Å–µ–∫—Ä–µ—Ç—ã –Ω–µ –Ω–∞ –¥–∏—Å–∫–µ)
- Requirement 8: –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –£–ó –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∞—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- Requirement 10: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏ —Å–∏—Å—Ç–µ–º–æ–π

#### ISO 27001

- A.9: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º (RBAC, –ø—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π)
- A.10: –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è (TLS 1.2+, mTLS, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤)
- A.12: –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–∞—É–¥–∏—Ç, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- A.18: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ (–ø–æ–ª–∏—Ç–∏–∫–∏, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**

–î–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Enterprise-—Å—Ä–µ–¥—ã.


