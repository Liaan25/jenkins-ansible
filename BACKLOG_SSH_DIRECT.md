# ðŸ”® BACKLOG: ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð½Ð° Ð¿Ñ€ÑÐ¼Ð¾Ð¹ SSH Ð¿Ð¾Ð´ Ð¢Ð£Ð— (Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2)

## ðŸ“‹ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: **Ð—ÐÐŸÐ›ÐÐÐ˜Ð ÐžÐ’ÐÐÐž** (Ð½Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾)

**Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ:** Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1 (Ð´Ð²ÑƒÑ…ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²Ñ‹Ð¹ sudo Ñ‡ÐµÑ€ÐµÐ· `mvp_dev`)  
**Ð¦ÐµÐ»ÐµÐ²Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ:** Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2 (Ð¿Ñ€ÑÐ¼Ð¾Ð¹ SSH Ð¿Ð¾Ð´ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð£Ð—)

---

## ðŸŽ¯ Ð¦ÐµÐ»ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

Ð£Ð±Ñ€Ð°Ñ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¾Ñ‚ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð£Ð— `mvp_dev` Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€ÑÐ¼Ð¾Ðµ SSH-Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Jenkins â†’ Ð¢Ð£Ð— (CI/CD Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ) Ð´Ð»Ñ Ð±Ð¾Ð»ÐµÐµ Ñ‡ÐµÑ‚ÐºÐ¾Ð³Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»Ð½Ð¾Ð¼Ð¾Ñ‡Ð¸Ð¹.

---

## ðŸ“Š Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð²

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1 (Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹)

```
Jenkins Pipeline (SSH key Ð´Ð»Ñ mvp_dev)
    â†“
SSH â†’ mvp_dev@server (Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ)
    â†“
sudo -u CI10742292-lnx-mon_ci (Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð° Ð¢Ð£Ð—)
    â†“
sudo -u CI10742292-lnx-mon_sys -g CI10742292-lnx-mon_sys (Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¡Ð£Ð—)
```

**ÐŸÐ»ÑŽÑÑ‹:**
- âœ… Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ
- âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ Ð¸Ð½Ñ„Ñ€Ð°ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ
- âœ… ÐÐµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð½Ð¾Ð²Ñ‹Ñ… SSH ÐºÐ»ÑŽÑ‡ÐµÐ¹

**ÐœÐ¸Ð½ÑƒÑÑ‹:**
- âš ï¸ Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¾Ñ‚ `mvp_dev` (Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð´Ð¾Ð»Ð³)
- âš ï¸ Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ sudo
- âš ï¸ ÐœÐµÐ½ÐµÐµ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹ audit trail

---

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2 (Ð¦ÐµÐ»ÐµÐ²Ð¾Ð¹)

```
Jenkins Pipeline (SSH key Ð´Ð»Ñ CI10742292-lnx-mon_ci)
    â†“
SSH â†’ CI10742292-lnx-mon_ci@server (Ð¿Ñ€ÑÐ¼Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´ Ð¢Ð£Ð—)
    â†“
sudo -u CI10742292-lnx-mon_sys -g CI10742292-lnx-mon_sys (Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¡Ð£Ð—)
```

**ÐŸÐ»ÑŽÑÑ‹:**
- âœ… ÐŸÑ€ÑÐ¼Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´ Ð½ÑƒÐ¶Ð½Ñ‹Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼
- âœ… ÐžÐ´Ð¸Ð½ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ sudo Ð²Ð¼ÐµÑÑ‚Ð¾ Ð´Ð²ÑƒÑ…
- âœ… Ð§ÐµÑ‚ÐºÐ¾Ðµ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ: Ð¾Ð´Ð½Ð° Ñ€Ð¾Ð»ÑŒ = Ð¾Ð´Ð¸Ð½ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ
- âœ… ÐÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¾Ñ‚ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð£Ð— Ñ‚Ð¸Ð¿Ð° `mvp_dev`
- âœ… Ð‘Ð¾Ð»ÐµÐµ Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ð¹ audit trail (ÑÑ€Ð°Ð·Ñƒ Ð²Ð¸Ð´Ð½Ð¾, ÐºÑ‚Ð¾ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°Ð»ÑÑ)

**ÐœÐ¸Ð½ÑƒÑÑ‹:**
- âš ï¸ Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ SSH ÐºÐ»ÑŽÑ‡Ð° Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð¢Ð£Ð—
- âš ï¸ Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ `authorized_keys` Ð´Ð»Ñ Ð¢Ð£Ð—
- âš ï¸ Jenkins Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ðµ credentials Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÑ‚ÐµÐ½Ð´Ð°

---

## ðŸ› ï¸ ÐŸÐ»Ð°Ð½ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

### Ð­Ñ‚Ð°Ð¿ 1: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ SSH ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð´Ð»Ñ Ð¢Ð£Ð— (IDM)

**Ð”Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÑ‚ÐµÐ½Ð´Ð°:**

1. **Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ SSH ÐºÐ»ÑŽÑ‡Ð° Ð² IDM** Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ `{KAE_STEND}-lnx-mon_ci`
   - Ð¢Ð¸Ð¿ ÐºÐ»ÑŽÑ‡Ð°: RSA 4096 Ð¸Ð»Ð¸ ED25519
   - Ð‘ÐµÐ· passphrase (Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸)
   
2. **ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ:**
   - ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ (Ð´Ð»Ñ Jenkins)
   - ÐŸÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ (Ð´Ð»Ñ `authorized_keys`)

3. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð² Jenkins Credentials:**
   - Credential ID: `ssh-key-{KAE_STEND}-ci`
   - Ð¢Ð¸Ð¿: SSH Username with private key
   - Username: `{KAE_STEND}-lnx-mon_ci`

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ ÑÑ‚ÐµÐ½Ð´Ð° CI10742292:**
```
Credential ID: ssh-key-CI10742292-ci
Username: CI10742292-lnx-mon_ci
Private Key: (paste from IDM)
```

---

### Ð­Ñ‚Ð°Ð¿ 2: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° authorized_keys Ð½Ð° Ñ†ÐµÐ»ÐµÐ²Ñ‹Ñ… ÑÐµÑ€Ð²ÐµÑ€Ð°Ñ…

**ÐÐ° ÐºÐ°Ð¶Ð´Ð¾Ð¼ ÑÐµÑ€Ð²ÐµÑ€Ðµ ÑÑ‚ÐµÐ½Ð´Ð°:**

```bash
# Ð’Ð¾Ð¹Ñ‚Ð¸ Ð¿Ð¾Ð´ Ð¡Ð£Ð— Ð¸Ð»Ð¸ root
sudo -i

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ .ssh Ð´Ð»Ñ Ð¢Ð£Ð—
mkdir -p /home/CI10742292-lnx-mon_ci/.ssh
chmod 700 /home/CI10742292-lnx-mon_ci/.ssh

# Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
cat >> /home/CI10742292-lnx-mon_ci/.ssh/authorized_keys << 'EOF'
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC... (Ð¿ÑƒÐ±Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡ Ð¸Ð· IDM)
EOF

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð°
chmod 600 /home/CI10742292-lnx-mon_ci/.ssh/authorized_keys
chown -R CI10742292-lnx-mon_ci:CI10742292-lnx-mon_ci /home/CI10742292-lnx-mon_ci/.ssh
```

**ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· RLM:**
- Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ RLM Ð´Ð»Ñ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ SSH ÐºÐ»ÑŽÑ‡Ð°
- ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÐºÐ¾ Ð²ÑÐµÐ¼ ÑÐµÑ€Ð²ÐµÑ€Ð°Ð¼ ÑÑ‚ÐµÐ½Ð´Ð°

---

### Ð­Ñ‚Ð°Ð¿ 3: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Jenkinsfile

**Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ñ… Pipeline:**

```groovy
parameters {
    // ...
    
    // Ð—ÐÐœÐ•ÐÐ˜Ð¢Ð¬:
    // string(name: 'SSH_CREDENTIALS_ID', defaultValue: 'ssh-mvp-dev', description: '...')
    
    // ÐÐ:
    string(
        name: 'SSH_CREDENTIALS_ID', 
        defaultValue: '', 
        description: 'SSH Credentials ID Ð´Ð»Ñ Ð¢Ð£Ð— (Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚: ssh-key-{KAE_STEND}-ci). Ð•ÑÐ»Ð¸ Ð¿ÑƒÑÑ‚Ð¾ - Ð°Ð²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ'
    )
}
```

**Ð›Ð¾Ð³Ð¸ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ SSH Credentials:**

```groovy
stage('Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²') {
    steps {
        script {
            // Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ðµ KAE_STEND
            def namespaceParts = params.NAMESPACE_CI.split('_')
            env.KAE_STEND = namespaceParts[-1]
            
            // ÐÐ²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ SSH Credentials ID
            if (params.SSH_CREDENTIALS_ID == '') {
                env.SSH_CREDENTIALS_ID = "ssh-key-${env.KAE_STEND}-ci"
                echo "âœ“ SSH Credentials ID Ð°Ð²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½: ${env.SSH_CREDENTIALS_ID}"
            } else {
                env.SSH_CREDENTIALS_ID = params.SSH_CREDENTIALS_ID
                echo "âœ“ SSH Credentials ID Ð·Ð°Ð´Ð°Ð½ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ: ${env.SSH_CREDENTIALS_ID}"
            }
            
            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ credentials
            try {
                withCredentials([sshUserPrivateKey(credentialsId: env.SSH_CREDENTIALS_ID, keyFileVariable: 'TEST_KEY')]) {
                    echo "âœ“ SSH Credentials Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹"
                }
            } catch (Exception e) {
                error """
                âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ: SSH Credentials Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹!
                
                ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Credentials ID: ${env.SSH_CREDENTIALS_ID}
                
                Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾:
                1. Credentials ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ Ð² Jenkins
                2. Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° ÐµÐ³Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ
                3. Ð˜Ð¼Ñ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñƒ: ssh-key-{KAE_STEND}-ci
                
                Ð˜Ð»Ð¸ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Credentials ID Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ SSH_CREDENTIALS_ID.
                """
            }
        }
    }
}
```

**ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ SSH ÐºÐ¾Ð¼Ð°Ð½Ð´:**

```groovy
// Ð‘Ð«Ð›Ðž (Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1):
ssh -i "${SSH_KEY}" -o StrictHostKeyChecking=no "${SSH_USER}@${params.SERVER_ADDRESS}" \
    "sudo -u ${env.USER_CI} sudo -u ${env.USER_SYS} -g ${env.USER_SYS} mkdir -p /dev/shm/monitoring_secrets"

// Ð¡Ð¢ÐÐÐ•Ð¢ (Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2):
ssh -i "${SSH_KEY}" -o StrictHostKeyChecking=no "${env.USER_CI}@${params.SERVER_ADDRESS}" \
    "sudo -u ${env.USER_SYS} -g ${env.USER_SYS} mkdir -p /dev/shm/monitoring_secrets"
```

**ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:**
1. `${SSH_USER}` â†’ `${env.USER_CI}` (Ð¿Ñ€ÑÐ¼Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´ Ð¢Ð£Ð—)
2. Ð£Ð±Ñ€Ð°Ð½ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ `sudo -u ${env.USER_CI}` (ÑƒÐ¶Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ Ð¿Ð¾Ð´ Ð½Ð¸Ð¼)
3. ÐžÑÑ‚Ð°Ð»ÑÑ Ð¾Ð´Ð¸Ð½ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ `sudo -u ${env.USER_SYS} -g ${env.USER_SYS}`

---

### Ð­Ñ‚Ð°Ð¿ 4: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ sudoers

**Sudoers Ð´Ð»Ñ `mvp_dev` Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ.**

**Sudoers Ð´Ð»Ñ Ð¢Ð£Ð— Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹** (ÑƒÐ¶Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ Ð¿Ñ€Ð°Ð²Ð° Ð½Ð° `sudo -u SYS_USER`).

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°:**
```bash
# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð¿Ð¾Ð´ Ð¢Ð£Ð—
ssh -i ~/.ssh/CI10742292-lnx-mon_ci_key CI10742292-lnx-mon_ci@server

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ sudo Ð¿Ñ€Ð°Ð²Ð°
sudo -l

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¡Ð£Ð—
sudo -u CI10742292-lnx-mon_sys -g CI10742292-lnx-mon_sys whoami
# ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´: CI10742292-lnx-mon_sys
```

---

### Ð­Ñ‚Ð°Ð¿ 5: Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

**ÐŸÐ»Ð°Ð½ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:**

1. **Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÑ‚ÐµÐ½Ð´** (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `TEST123456`)
2. **Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ SSH ÐºÐ»ÑŽÑ‡** Ð´Ð»Ñ `TEST123456-lnx-mon_ci`
3. **Ð Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÐºÐ»ÑŽÑ‡** Ð½Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€
4. **Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ credentials** Ð² Jenkins (ID: `ssh-key-TEST123456-ci`)
5. **Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Pipeline** Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð¼ `NAMESPACE_CI=TEST_TEST123456`
6. **ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ:**
   - SSH Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð¿Ð¾Ð´ Ð¢Ð£Ð—
   - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ `/dev/shm/monitoring_secrets`
   - ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° ÑÐµÐºÑ€ÐµÑ‚Ð¾Ð²
   - Ð Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· Ansible
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²

**Expected behavior:**
```
âœ“ SSH Credentials ID Ð°Ð²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½: ssh-key-TEST123456-ci
âœ“ SSH Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ: TEST123456-lnx-mon_ci@test-server
âœ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ ÑÐµÐºÑ€ÐµÑ‚Ð¾Ð² Ð¾Ñ‚ Ð¡Ð£Ð—
âœ“ ÐŸÐµÑ€ÐµÐ´Ð°Ñ‡Ð° ÑÐµÐºÑ€ÐµÑ‚Ð¾Ð²
âœ“ Ð Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾
```

---

### Ð­Ñ‚Ð°Ð¿ 6: ÐŸÐ¾ÑÑ‚ÐµÐ¿ÐµÐ½Ð½Ð°Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ

**Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ:**

1. **Ð¤Ð°Ð·Ð° 1 (1-2 Ð½ÐµÐ´ÐµÐ»Ð¸):** Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¾Ð´Ð½Ð¾Ð¼ ÑÑ‚ÐµÐ½Ð´Ðµ
2. **Ð¤Ð°Ð·Ð° 2 (1 Ð¼ÐµÑÑÑ†):** ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð½Ð¾Ð²Ñ‹Ñ… ÑÑ‚ÐµÐ½Ð´Ð¾Ð² Ð½Ð° Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2
3. **Ð¤Ð°Ð·Ð° 3 (2-3 Ð¼ÐµÑÑÑ†Ð°):** ÐŸÐ¾ÑÑ‚ÐµÐ¿ÐµÐ½Ð½Ð°Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… ÑÑ‚ÐµÐ½Ð´Ð¾Ð²
4. **Ð¤Ð°Ð·Ð° 4:** Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ `mvp_dev`

**ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ ÑƒÑÐ¿ÐµÑ…Ð°:**
- Ð’ÑÐµ Ð½Ð¾Ð²Ñ‹Ðµ ÑÑ‚ÐµÐ½Ð´Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¿Ñ€ÑÐ¼Ð¾Ð¹ SSH
- 80%+ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… ÑÑ‚ÐµÐ½Ð´Ð¾Ð² Ð¼Ð¸Ð³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹
- Jenkins Pipeline Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¾Ð±Ð° Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ð° (backward compatibility)

---

## ðŸ“š Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

### Ð”Ð»Ñ DevOps ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

**Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ:** `docs/SSH_DIRECT_MIGRATION.md`

Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ:
- Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ñ Ð¿Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÑŽ SSH ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð² IDM
- ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð´Ð»Ñ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ `authorized_keys`
- Ð§ÐµÐºÐ»Ð¸ÑÑ‚ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ ÑÑ‚ÐµÐ½Ð´Ð°
- Troubleshooting

### Ð”Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

**ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:** `docs/SECURITY_ARCHITECTURE.md`

Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ:
- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹
- Audit trail Ð´Ð»Ñ Ð¿Ñ€ÑÐ¼Ð¾Ð³Ð¾ SSH
- ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ñ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð·Ñ€ÐµÐ½Ð¸Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

---

## ðŸš§ Ð Ð¸ÑÐºÐ¸ Ð¸ Ð¼Ð¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ

| Ð Ð¸ÑÐº | Ð’ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ | Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ | ÐœÐ¸Ñ‚Ð¸Ð³Ð°Ñ†Ð¸Ñ |
|------|-------------|---------|-----------|
| ÐŸÐ¾Ñ‚ÐµÑ€Ñ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ð¾Ð³Ð¾ SSH ÐºÐ»ÑŽÑ‡Ð° | Ð¡Ñ€ÐµÐ´Ð½ÑÑ | Ð’Ñ‹ÑÐ¾ÐºÐ¾Ðµ | Ð¥Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² Jenkins Credentials Ñ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼ |
| ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° `authorized_keys` | Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ | Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ | ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· RLM, Ñ‡ÐµÐºÐ»Ð¸ÑÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ |
| Credentials Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð² Jenkins | Ð¡Ñ€ÐµÐ´Ð½ÑÑ | Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ | ÐÐ²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ + fallback Ð½Ð° Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð²Ð²Ð¾Ð´ |
| ÐšÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚ Ð¼ÐµÐ¶Ð´Ñƒ ÑÑ‚Ð°Ñ€Ð¾Ð¹ Ð¸ Ð½Ð¾Ð²Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸ÐµÐ¹ | ÐÐ¸Ð·ÐºÐ°Ñ | Ð’Ñ‹ÑÐ¾ÐºÐ¾Ðµ | ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° backward compatibility Ð² Jenkinsfile |

---

## âœ… ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ðº Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

- [ ] SSH ÐºÐ»ÑŽÑ‡Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð´Ð»Ñ Ð²ÑÐµÑ… Ñ†ÐµÐ»ÐµÐ²Ñ‹Ñ… ÑÑ‚ÐµÐ½Ð´Ð¾Ð²
- [ ] `authorized_keys` Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚Ñ‹ Ð½Ð° Ð²ÑÐµÑ… ÑÐµÑ€Ð²ÐµÑ€Ð°Ñ…
- [ ] Credentials Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð² Jenkins
- [ ] Jenkinsfile Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½ Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ Ð°Ð²Ñ‚Ð¾Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ñ
- [ ] Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð°
- [ ] Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¹Ð´ÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
- [ ] ÐŸÐ»Ð°Ð½ rollback Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½

---

## ðŸ”„ Rollback Ð¿Ð»Ð°Ð½

**Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº:**

1. **Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÑÑ‚Ð°Ñ€ÑƒÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ Jenkinsfile** (Ñ `mvp_dev`)
2. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ SSH_CREDENTIALS_ID** (`ssh-mvp-dev`)
3. **Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ SSH ÐºÐ»ÑŽÑ‡Ð¸** Ð´Ð»Ñ Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¹ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸

**Ð’Ñ€ÐµÐ¼Ñ rollback:** < 5 Ð¼Ð¸Ð½ÑƒÑ‚ (Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÑŒ commit Ð² Git)

---

## ðŸ“ž ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹

**ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð·Ð° Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ:** DevOps Team Lead  
**ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¿Ð¾ SSH ÐºÐ»ÑŽÑ‡Ð°Ð¼:** IDM Support  
**Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸:** Security Team

---

## ðŸ“… ÐŸÐ»Ð°Ð½Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ñ‚Ñ‹

| Ð­Ñ‚Ð°Ð¿ | Ð”Ð°Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»Ð° | Ð”Ð°Ñ‚Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ |
|------|-------------|-----------------|--------|
| Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ SSH ÐºÐ»ÑŽÑ‡ÐµÐ¹ | TBD | TBD | â³ ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾ |
| ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Jenkinsfile | TBD | TBD | â³ ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾ |
| Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ | TBD | TBD | â³ ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾ |
| ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ (Pilot) | TBD | TBD | â³ ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾ |
| ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ (Production) | TBD | TBD | â³ ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾ |
| Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ | TBD | TBD | â³ ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾ |

---

**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½:** November 19, 2024  
**Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð¿ÐµÑ€ÐµÑÐ¼Ð¾Ñ‚Ñ€:** TBD

