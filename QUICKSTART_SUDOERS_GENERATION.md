# ‚ö° Quick Start: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Sudoers –¥–ª—è IDM

> –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## üéØ –¶–µ–ª—å

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å sudoers —Ñ–∞–π–ª—ã —Å SHA256 —Ö–µ—à–∞–º–∏ –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤ IDM **–¥–æ** –∑–∞–ø—É—Å–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è.

---

## üìù –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

```
–≠—Ç–∞–ø 1: PREPARE  ‚Üí  –ì–µ–Ω–µ—Ä–∞—Ü–∏—è sudoers  ‚Üí  –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –≤ IDM
                         ‚Üì
–≠—Ç–∞–ø 2: DEPLOY   ‚Üí  –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

---

## üöÄ –≠—Ç–∞–ø 1: PREPARE (5 –º–∏–Ω—É—Ç)

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Jenkins

1. –û—Ç–∫—Ä—ã—Ç—å Jenkins Job
2. Build with Parameters
3. –í—ã–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **STAGE_MODE**: `prepare`
   - **NAMESPACE_CI**: `CI04523276_CI10742292`
   - **SERVER_ADDRESS**: `server.example.com`
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å
5. Pipeline –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
6. –°–∫–∞—á–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: `${BUILD_URL}artifact/generated_sudoers_for_idm/`

### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–æ

```bash
cd secure_deployment/sudoers
./generate_sudoers_with_hashes.sh CI04523276_CI10742292
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `$HOME/monitoring_sudoers_generated/CI10742292/`

---

## üì¶ –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏?

```
CI10742292/
‚îú‚îÄ‚îÄ sudoers/                         ‚Üê –î–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ IDM
‚îÇ   ‚îú‚îÄ‚îÄ CI10742292-lnx-mon_ci        ‚Üê –¢–£–ó (3 —Ñ–∞–π–ª–∞)
‚îÇ   ‚îú‚îÄ‚îÄ CI10742292-lnx-mon_admin     ‚Üê –ü–£–ó
‚îÇ   ‚îî‚îÄ‚îÄ CI10742292-lnx-mon_ro        ‚Üê ReadOnly
‚îú‚îÄ‚îÄ scripts/                         ‚Üê –î–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ manage_firewall.sh
‚îÇ   ‚îú‚îÄ‚îÄ manage_vault_certs.sh
‚îÇ   ‚îî‚îÄ‚îÄ call_rlm_api.sh
‚îú‚îÄ‚îÄ INSTRUCTIONS.md                  ‚Üê –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îî‚îÄ‚îÄ README.txt                       ‚Üê –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
```

---

## üìã –®–∞–≥ 1: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (10 –º–∏–Ω—É—Ç)

```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
cd $HOME/monitoring_sudoers_generated/CI10742292
scp scripts/*.sh user@server:/tmp/

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å
ssh user@server
sudo mkdir -p /opt/monitoring/scripts/wrappers
sudo cp /tmp/*.sh /opt/monitoring/scripts/wrappers/
sudo chown CI10742292-lnx-mon_ci:CI10742292-lnx-mon_sys /opt/monitoring/scripts/wrappers/*.sh
sudo chmod 750 /opt/monitoring/scripts/wrappers/*.sh

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SHA256 (–í–ê–ñ–ù–û!)
sha256sum /opt/monitoring/scripts/wrappers/*.sh
# –°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ö–µ—à–∞–º–∏ –≤ INSTRUCTIONS.md
```

---

## üìù –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫–∏ –≤ IDM (15 –º–∏–Ω—É—Ç)

**–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å 3 –∑–∞—è–≤–∫–∏** (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):

### –ó–∞—è–≤–∫–∞ 1: –î–ª—è CI_USER

1. https://idm.sberbank.ru/ ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
2. –¢–∏–ø: "–ü—Ä–∞–≤–∞ sudo –¥–ª—è Linux"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `CI10742292-lnx-mon_ci`
4. –°–µ—Ä–≤–µ—Ä—ã: `server.example.com` (FQDN)
5. **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ sudoers**: 
   ```bash
   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –í–ï–°–¨ –§–ê–ô–õ:
   cat $HOME/monitoring_sudoers_generated/CI10742292/sudoers/CI10742292-lnx-mon_ci
   ```
6. –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:
   ```
   –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
   –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç-–æ–±–µ—Ä—Ç–∫–∏ —Å SHA256 —Ö–µ—à–∞–º–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
   –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
   ```
7. –û—Ç–ø—Ä–∞–≤–∏—Ç—å

### –ó–∞—è–≤–∫–∞ 2: –î–ª—è ADMIN_USER

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `CI10742292-lnx-mon_admin`
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –∏–∑ —Ñ–∞–π–ª–∞ `CI10742292-lnx-mon_admin`

### –ó–∞—è–≤–∫–∞ 3: –î–ª—è RO_USER

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `CI10742292-lnx-mon_ro`
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –∏–∑ —Ñ–∞–π–ª–∞ `CI10742292-lnx-mon_ro`

---

## ‚è±Ô∏è –®–∞–≥ 3: –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è (1-3 –¥–Ω—è)

–ó–∞—è–≤–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ:
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –û–°
- –°–ª—É–∂–±–∞ –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- IDM –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:** https://idm.sberbank.ru/requests/

---

## ‚úÖ –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ (5 –º–∏–Ω—É—Ç)

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å–µ 3 –∑–∞—è–≤–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo -l -U CI10742292-lnx-mon_ci
sudo -l -U CI10742292-lnx-mon_admin
sudo -l -U CI10742292-lnx-mon_ro

# –¢–µ—Å—Ç firewall wrapper
sudo -u CI10742292-lnx-mon_ci /opt/monitoring/scripts/wrappers/manage_firewall.sh check prometheus
```

–ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç ‚Üí –ø—Ä–∞–≤–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã! ‚úÖ

---

## üöÄ –≠—Ç–∞–ø 2: DEPLOY (20-30 –º–∏–Ω—É—Ç)

**–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ!):**
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –≤ `/opt/monitoring/scripts/wrappers/`
- ‚úÖ SHA256 —Ö–µ—à–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç
- ‚úÖ –í—Å–µ 3 –∑–∞—è–≤–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã (`sudo -l -U ...`)

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Jenkins

1. –û—Ç–∫—Ä—ã—Ç—å —Ç–æ—Ç –∂–µ Jenkins Job
2. Build with Parameters
3. –í—ã–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - **STAGE_MODE**: `deploy` ‚Üê –ò–∑–º–µ–Ω–∏—Ç—å!
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - **—Ç–µ –∂–µ** —á—Ç–æ –∏ –≤ PREPARE
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å

**Pipeline –≤—ã–ø–æ–ª–Ω–∏—Ç:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É sudo –ø—Ä–∞–≤
2. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫—É Prometheus, Grafana, Harvest (–∏–∑ tar.gz)
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫—É Vault Agent
4. ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏
5. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ User Systemd Units
6. ‚úÖ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞:
- Prometheus: `https://server:9090`
- Grafana: `https://server:3000`
- Harvest: –ø–æ—Ä—Ç—ã 12990, 13001, 13000-14000

---

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "SHA256 –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sha256sum /opt/monitoring/scripts/wrappers/manage_firewall.sh

# –°—Ä–∞–≤–Ω–∏—Ç—å —Å INSTRUCTIONS.md
cat $HOME/monitoring_sudoers_generated/CI10742292/INSTRUCTIONS.md | grep SHA256
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied" –≤ DEPLOY

**–ü—Ä–∏—á–∏–Ω–∞:** Sudo –ø—Ä–∞–≤–∞ –µ—â–µ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–∫–∏ –≤ IDM (–≤—Å–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã?)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 10-15 –º–∏–Ω—É—Ç (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `sudo -l -U CI10742292-lnx-mon_ci`

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞—è–≤–∫–∞ –≤ IDM –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
2. –ò–∑—É—á–∏—Ç—å [CORPORATE_SECURITY_RULES.md](docs/CORPORATE_SECURITY_RULES.md)
3. –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å templates –∏ –ø–µ—Ä–µ—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [SUDOERS_GENERATION_PROCESS.md](docs/SUDOERS_GENERATION_PROCESS.md) - –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
- [CORPORATE_SECURITY_RULES.md](docs/CORPORATE_SECURITY_RULES.md) - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [IDM_ACCOUNTS_GUIDE.md](docs/IDM_ACCOUNTS_GUIDE.md) - –†–∞–±–æ—Ç–∞ —Å IDM

---

## ‚è±Ô∏è –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π |
|------|-------|---------------|
| PREPARE (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è) | 5 –º–∏–Ω | DevOps |
| –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ | 10 –º–∏–Ω | DevOps / Admin |
| –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ IDM | 15 –º–∏–Ω | DevOps |
| **–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è** | **1-3 –¥–Ω—è** | IDM / Security |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ | 5 –º–∏–Ω | DevOps / Admin |
| DEPLOY (—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ) | 20-30 –º–∏–Ω | DevOps (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) |
| **–ò–¢–û–ì–û (–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è)** | **~55 –º–∏–Ω** | |

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** November 19, 2024


